name: 4testing multiarch-build

on:
  repository_dispatch:
    types:
      - cron-trigger-action
      - config-trigger-action
      - client-trigger-action
      - server-trigger-action

jobs:
  prepare-branches:
    runs-on: ubuntu-latest
    outputs: 
      branches: ${{ steps.prepare.outputs.branches }}
    steps:
      - name: prepare branches
        id: prepare
        env:
          branches: ${{ join(github.event.client_payload.branches) }}
        run: |
          echo "branches=$(echo ${branches} | sed 's!,! !g')" >> "$GITHUB_OUTPUT"

  call-reusable-build:
    needs: 'prepare-branches'
    uses: ONLYOFFICE/DocSpace-buildtools/.github/workflows/reusable-build.yml@master
    secrets:
      docker-username: ${{ secrets.DOCKERHUB_USERNAME }}
      docker-usertoken: ${{ secrets.DOCKERHUB_TOKEN }}
      git-token: ${{ secrets.TOKEN }}
    with:
      payload-branches: "${{ needs.prepare-branches.outputs.branches }}"
      dispatch-type: "${{ github.event.action }}"
      dockerhub-repo: "onlyoffice"

